# indra - 依存関係図

## 1. フェーズ間依存関係

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   Phase 1: 基盤                                                             │
│   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                      │
│   │   CLI基本   │   │  Web UI基本 │   │   Gateway   │                      │
│   │  Commander  │   │  Vite + Lit │   │  Hono + ws  │                      │
│   └──────┬──────┘   └──────┬──────┘   └──────┬──────┘                      │
│          │                 │                 │                              │
│          └─────────────────┼─────────────────┘                              │
│                            │                                                │
└────────────────────────────┼────────────────────────────────────────────────┘
                             │
                             ▼
┌────────────────────────────┼────────────────────────────────────────────────┐
│                            │                                                │
│   Phase 2: LLM統合 ✅ 完了  │                                                │
│   ┌────────────────────────▼────────────────────────┐                      │
│   │              Claude Agent SDK                   │                      │
│   │    ┌────────────────────────────────────────┐   │                      │
│   │    │ サブスク認証 | opus/sonnet/haiku      │   │                      │
│   │    └────────────────────────────────────────┘   │                      │
│   └────────────────────────┬────────────────────────┘                      │
│                            │                                                │
│   ┌────────────────────────▼────────────────────────┐                      │
│   │           ストリーミング対応                     │                      │
│   └────────────────────────┬────────────────────────┘                      │
│                            │                                                │
└────────────────────────────┼────────────────────────────────────────────────┘
                             │
                             ▼
┌────────────────────────────┼────────────────────────────────────────────────┐
│                            │                                                │
│   Phase 3: SNS連携 + 承認フロー                                             │
│   ┌────────────────────────▼────────────────────────┐                      │
│   │           SNSコネクター                          │                      │
│   │       ┌──────────┐    ┌──────────┐              │                      │
│   │       │ X (API)  │    │   note   │              │                      │
│   │       └────┬─────┘    └────┬─────┘              │                      │
│   └────────────┼───────────────┼────────────────────┘                      │
│                │               │                                            │
│                └───────┬───────┘                                            │
│                        ▼                                                    │
│   ┌────────────────────────────────────────────────┐                       │
│   │    投稿作成 → 承認キュー → 投稿実行             │                       │
│   └────────────────────────┬───────────────────────┘                       │
│                            │                                                │
└────────────────────────────┼────────────────────────────────────────────────┘
                             │
              ┌──────────────┴──────────────┐
              ▼                              ▼
┌─────────────────────────────┐  ┌─────────────────────────────┐
│                             │  │                             │
│  Phase 4: スケジュール      │  │  Phase 5: マルチエージェント │
│  ┌───────────────────────┐  │  │  ┌───────────────────────┐  │
│  │ スケジューラー (cron) │  │  │  │ エージェント管理      │  │
│  └───────────┬───────────┘  │  │  └───────────┬───────────┘  │
│              ▼              │  │              ▼              │
│  ┌───────────────────────┐  │  │  ┌───────────────────────┐  │
│  │ ダッシュボード        │  │  │  │ タスク分散            │  │
│  └───────────────────────┘  │  │  └───────────────────────┘  │
│                             │  │                             │
└─────────────────────────────┘  └─────────────────────────────┘
```

---

## 2. Phase 1 詳細依存関係

```
                        ┌─────────────────────┐
                        │     P1-1-1          │
                        │  pnpm monorepo      │
                        │    セットアップ      │
                        └──────────┬──────────┘
                                   │
                 ┌─────────────────┼─────────────────┐
                 │                 │                 │
                 ▼                 ▼                 ▼
        ┌────────────────┐ ┌────────────────┐ ┌────────────────┐
        │    P1-1-2      │ │    P1-1-4      │ │    P1-3-1      │
        │  TypeScript    │ │  Oxlint/Oxfmt  │ │  Vite + Lit    │
        │    設定        │ │     設定       │ │  プロジェクト   │
        └───────┬────────┘ └────────────────┘ └───────┬────────┘
                │                                      │
       ┌────────┼────────┐                            │
       │        │        │                            │
       ▼        ▼        ▼                            ▼
┌──────────┐┌──────────┐┌──────────┐          ┌──────────────┐
│ P1-1-3   ││ P1-2-1   ││ P1-4-1   │          │   P1-3-2     │
│ Vitest   ││Commander ││ Hono+ws  │          │ 接続状態表示 │◄────┐
│  設定    ││ 基本構成 ││  基盤    │          └──────┬───────┘     │
└──────────┘└────┬─────┘└────┬─────┘                 │             │
                 │           │                       ▼             │
                 ▼           ▼                ┌──────────────┐     │
           ┌──────────┐┌──────────┐           │   P1-3-3     │     │
           │ P1-2-2   ││ P1-4-2   │           │ チャットUI   │     │
           │  clack   ││   WS     │───────────┴──────────────┘     │
           │ prompts  ││プロトコル│────────────────────────────────┘
           └────┬─────┘└────┬─────┘
                │           │
       ┌────────┴────┐      ▼
       │             │ ┌──────────┐
       ▼             ▼ │ P1-4-3   │
┌──────────┐  ┌──────────┐│セッション│
│ P1-2-3   │  │ P1-2-4   ││  管理    │
│  chat    │◄─┤ config   │└──────────┘
│ コマンド │  │ コマンド │
└──────────┘  └──────────┘
      ▲
      │
      └─── P1-4-2 に依存
```

---

## 3. Phase 2-3 依存関係

```
                    ┌─────────────────┐
                    │     P1-4-3      │
                    │  セッション管理  │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │     P2-1-1      │
                    │ Claude Agent SDK│
                    │  (サブスク認証)  │
                    └────────┬────────┘
                             │
              ┌──────────────┴──────────────┐
              │                             │
              ▼                             ▼
        ┌──────────┐                  ┌────────┐
        │  P2-2-1  │                  │P3-1-1  │
        │ストリーム │                  │SNS IF  │
        │プロトコル │                  └───┬────┘
        └────┬─────┘                       │
             │              ┌──────────────┴──────────────┐
             │              │              │              │
             │              ▼              ▼              ▼
             │         ┌────────┐    ┌────────┐    ┌────────┐
             │         │P3-1-2  │    │P3-1-3  │    │P3-2-1  │
             │         │ X API  │    │ note   │    │プロンプト│
        │                       └───┬────┘ └────────┘ └───┬────┘
   ┌────┴────┐                      │                     │
   │         │                      │    ┌────────────────┤
   ▼         ▼                      │    │                │
┌──────┐ ┌──────┐                   │    ▼                ▼
│P2-2-2│ │P2-2-3│                   │ ┌────────┐    ┌────────┐
│CLI   │ │Web UI│                   │ │P3-2-2  │    │P3-2-3  │
│表示  │ │表示  │                   │ │CLI     │    │UI      │
└──────┘ └──────┘                   │ │create  │    │preview │
                                    │ └────────┘    └────────┘
                                    │
                                    ▼
                              ┌───────────┐
                              │  P3-3-1   │
                              │ 承認キュー │
                              └─────┬─────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    ▼               ▼               ▼
              ┌──────────┐   ┌──────────┐   ┌──────────┐
              │  P3-3-2  │   │  P3-3-3  │   │  P3-3-4  │◄─ P3-1-2
              │   CLI    │   │  Web UI  │   │ 投稿実行 │
              │ approve  │   │キュー表示│   │          │
              └──────────┘   └──────────┘   └──────────┘
```

---

## 4. クリティカルパス（MVP必須経路）

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  ★ MVP達成に必要な最短経路                                                  │
│                                                                              │
│  ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐            │
│  │P1-1-1  │──▶│P1-1-2  │──▶│P1-4-1  │──▶│P1-4-2  │──▶│P1-4-3  │            │
│  │monorepo│   │TS設定  │   │ Hono   │   │  WS    │   │Session │            │
│  └────────┘   └────────┘   └────────┘   └────────┘   └───┬────┘            │
│                                                          │                  │
│                                                          ▼                  │
│  ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐            │
│  │P3-3-4  │◀──│P3-1-2  │◀──│P3-1-1  │◀──│P2-2-1  │◀──│P2-1-1  │            │
│  │投稿実行│   │ X API  │   │SNS IF  │   │Stream  │   │AgentSDK│            │
│  └────────┘   └────────┘   └────────┘   └────────┘   └────────┘            │
│                                                                              │
│  合計: 8タスク（LLMプロバイダー統合により削減）                             │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 並行開発可能なタスクグループ

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  グループA: Phase 1 並行開発（P1-1-2 完了後）                              │
│  ════════════════════════════════════════════                              │
│                                                                             │
│      ┌─────────────────┐                                                   │
│      │    P1-1-2       │                                                   │
│      │  TypeScript設定  │                                                   │
│      └────────┬────────┘                                                   │
│               │                                                             │
│      ┌────────┼────────┬────────────────┐                                  │
│      │        │        │                │                                  │
│      ▼        ▼        ▼                ▼                                  │
│  ┌───────┐┌───────┐┌───────┐      ┌───────────┐                           │
│  │ CLI   ││Web UI ││Gateway│      │  Vitest   │                           │
│  │P1-2-x ││P1-3-x ││P1-4-x │      │  P1-1-3   │                           │
│  └───────┘└───────┘└───────┘      └───────────┘                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  グループB: LLM統合 ✅ 完了（Claude Agent SDK採用）                        │
│  ═══════════════════════════════════════════════════                        │
│                                                                             │
│      ┌─────────────────────────────────────────────┐                       │
│      │              P2-1-1                         │                       │
│      │         Claude Agent SDK                    │                       │
│      │   ┌───────────────────────────────────┐     │                       │
│      │   │ サブスク認証 | opus/sonnet/haiku  │     │                       │
│      │   └───────────────────────────────────┘     │                       │
│      └─────────────────────┬───────────────────────┘                       │
│                            │                                                │
│                            ▼                                                │
│                   ┌───────────────┐                                        │
│                   │   P2-2-1      │                                        │
│                   │ ストリーミング │                                        │
│                   └───────────────┘                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  グループC: SNSコネクター並行開発（P3-1-1 完了後）                         │
│  ═════════════════════════════════════════════════                         │
│                                                                             │
│      ┌─────────────────┐                                                   │
│      │    P3-1-1       │                                                   │
│      │   SNS IF設計    │                                                   │
│      └────────┬────────┘                                                   │
│               │                                                             │
│      ┌────────┴────────┐                                                   │
│      │                 │                                                   │
│      ▼                 ▼                                                   │
│  ┌───────────┐   ┌───────────┐                                            │
│  │  X API    │   │   note    │                                            │
│  │  P3-1-2   │   │  P3-1-3   │                                            │
│  └───────────┘   └───────────┘                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  グループD: Phase 4-5 並行開発（P3-3-4 / P2-2-1 完了後）                   │
│  ═══════════════════════════════════════════════════════                   │
│                                                                             │
│          P3-3-4                         P2-2-1                             │
│         投稿実行                       ストリーミング                       │
│            │                              │                                 │
│      ┌─────┴─────┐                        │                                 │
│      │           │                        │                                 │
│      ▼           ▼                        ▼                                 │
│  ┌───────┐   ┌───────┐              ┌───────────┐                          │
│  │P4-1-x │   │P4-2-x │              │  P5-1-x   │                          │
│  │Schedule│  │ Dash  │              │ マルチAgent│                         │
│  └───────┘   └───────┘              └───────────┘                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 重要度マトリクス

```
                    高 ◄────────── 依存度 ──────────► 低
            ┌─────────────────────────────────────────────────┐
            │                                                 │
         高 │  ◆ P1-1-1    ◆ P1-4-2    ✅ P2-1-1             │
            │    monorepo     WS Proto   AgentSDK(完了)       │
   重       │                                                 │
   要       │  ◆ P1-1-2    ◆ P1-4-3                          │
   度       │    TS設定      Session                          │
            │                                                 │
            ├─────────────────────────────────────────────────┤
            │                                                 │
         中 │  ● P3-1-1    ● P3-1-2    ● P3-3-1             │
            │    SNS IF       X API      承認Queue           │
            │                                                 │
            │  ● P3-3-4    ● P2-2-1                          │
            │    投稿実行    Stream                           │
            │                                                 │
            ├─────────────────────────────────────────────────┤
            │                                                 │
         低 │  ○ P4-1-1    ○ P4-2-1    ○ P5-1-1             │
            │    Scheduler    Metrics     Agent管理          │
            │                                                 │
            │  ○ P1-1-4    ○ P4-3-1                          │
            │    Linter      Auth暗号化                       │
            │                                                 │
            └─────────────────────────────────────────────────┘

    凡例:  ◆ 最優先（ブロッカー）   ● 高優先（必須）   ○ 後回し可
```

---

## 7. 開発タイムライン（推奨）

```
Week 1-2                    Week 3-4                    Week 5-8 ✅
────────────────────────────────────────────────────────────────────
    │                           │                           │
    │  ┌─────────────────┐      │  ┌─────────────────┐      │  ┌─────────────────┐
    │  │ 初期化          │      │  │ CLI/UI/GW 並行  │      │  │ LLM統合 ✅完了  │
    │  │ ・monorepo      │ ──▶  │  │ ・chat コマンド │ ──▶  │  │ ・AgentSDK     │
    │  │ ・TypeScript    │      │  │ ・チャットUI   │      │  │ ・サブスク認証  │
    │  │ ・Gateway基盤   │      │  │ ・セッション   │      │  │ ・ストリーミング │
    │  └─────────────────┘      │  └─────────────────┘      │  └─────────────────┘
    │                           │                           │
────────────────────────────────────────────────────────────────────

Week 9-12                   Week 13-16                  Week 17-20
────────────────────────────────────────────────────────────────────
    │                           │                           │
    │  ┌─────────────────┐      │  ┌─────────────────┐      │  ┌─────────────────┐
    │  │ SNS連携         │      │  │ スケジュール    │      │  │ マルチAgent     │
    │  │ ・X コネクター  │ ──▶  │  │ ・cron         │ ──▶  │  │ ・Agent管理     │
    │  │ ・承認フロー    │      │  │ ・ダッシュボード│      │  │ ・タスク分散    │
    │  │ ・投稿実行      │      │  │ ・メトリクス   │      │  │ ・フロー可視化  │
    │  └─────────────────┘      │  └─────────────────┘      │  └─────────────────┘
    │                           │                           │
────────────────────────────────────────────────────────────────────
         MVP完成 ▲
```
